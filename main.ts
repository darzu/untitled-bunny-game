namespace SpriteKind {
    export const Scene = SpriteKind.create()
}
/**
 * snow line - y 88
 * 
 * bunny game:
 * 
 * Above Ground Mode:
 * 
 * - pick carrots
 * 
 * - avoid farmers
 * 
 * Stealth Mode:
 * 
 * - moving in snow
 * 
 * - sneaking
 * 
 * Procedural content:
 * 
 * - carrots & farmers
 * 
 * - snow dunes
 * 
 * - ???
 * 
 * TODO:
 * 
 * [x] looking left vs right
 * 
 * [ ] farmers
 */
/**
 * SPRITE REQUESTS:
 * 
 * 1. Farmer
 * 
 * 2. Angry animation (when they find you)
 * 
 * 3. Snowman animation (when hit with snowball)
 * 
 * 4. Optional: attack animation
 */
/**
 * Farmer behavior:
 * 
 * - looking direction
 * 
 * - turn that takes time
 * 
 * - spotting the player
 * 
 * - attacking
 * 
 * - being hit with snowball
 * 
 * normal states:
 * 
 * X wander in dir
 * 
 * X idle
 * 
 * X turning
 * 
 * TODO:
 * 
 * [ ] staying home
 */
/**
 * left:
 * 
 *    enemyX - playerX < 30
 */
function spawnChunk (startX: number) {
    spawnChoice = randint(0, 10)
    if (spawnChoice <= 1) {
        carrot = sprites.create(img`
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . 7 . . . . . . . . . 
            . . . 7 7 . 7 . . . . . . . . . 
            . . . . . 7 . . . . . . . . . . 
            . . . . . 4 4 . . . . . . . . . 
            . . . . 4 4 4 . . . . . . . . . 
            . . . . 4 4 4 . . . . . . . . . 
            . . . . . b 4 e . . . . . . . . 
            . . . . . . 4 4 4 . . . . . . . 
            . . . . . . . 4 4 . . . . . . . 
            . . . . . . . b 4 . . . . . . . 
            . . . . . . . 4 4 . . . . . . . 
            . . . . . . . 4 e . . . . . . . 
            . . . . . . . 4 . . . . . . . . 
            . . . . . . . e . . . . . . . . 
            `, SpriteKind.Food)
        carrot.x = startX
        carrot.y = 88
    } else if (spawnChoice <= 3) {
        dune = sprites.create(img`
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . 1 1 1 . . . . . 
            . . . . . . 1 1 1 1 1 1 1 1 . . 
            . . . . 1 1 1 1 1 1 1 1 1 1 1 . 
            . . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 
            1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 
            `, SpriteKind.Scene)
        dune.x = startX
        dune.bottom = 88
    } else if (spawnChoice <= 5) {
        spawnFarmer(startX)
    } else {
    	
    }
}
function toChunkIdx (num: number) {
    return Math.idiv(num, chunkWidth)
}
controller.B.onEvent(ControllerButtonEvent.Pressed, function () {
    sneaking = !(sneaking)
    switchModes(sneaking)
})
function updateEnemy (enemy: Sprite, state: string) {
    if (enemy.x < sprites.readDataNumber(enemy, "boundLeft")) {
        if (sprites.readDataBoolean(enemy, "lookingRight")) {
            startEnemyState(enemy, "wandering")
        } else {
            startEnemyState(enemy, "turning")
        }
        return
    } else if (sprites.readDataNumber(enemy, "boundRight") < enemy.x) {
        if (sprites.readDataBoolean(enemy, "lookingRight")) {
            startEnemyState(enemy, "turning")
        } else {
            startEnemyState(enemy, "wandering")
        }
        return
    }
    isIdle = state == "stopped" || (state == "turning" || state == "wandering")
    if (isIdle) {
        if (Math.percentChance(33)) {
            startEnemyState(enemy, "stopped")
        } else if (Math.percentChance(50)) {
            startEnemyState(enemy, "turning")
        } else {
            startEnemyState(enemy, "wandering")
        }
    } else if (state == "chasing") {
        startEnemyState(enemy, "stopped")
    }
}
controller.A.onEvent(ControllerButtonEvent.Pressed, function () {
    for (let value of sprites.allOfKind(SpriteKind.Enemy)) {
        startEnemyState(value, "stopped")
        frames = [img`
            .........................
            .........................
            .........................
            .........................
            .........................
            ..........222222.........
            ..........4444222........
            ..........dddd422........
            .........dfddfd42........
            .......b.ddddddd4........
            .....b.cb.2222222........
            .....cb.cb22222442.......
            ......cb.cb44445422......
            .111119cbbc555554e22.....
            .111111bcc55554554e2.....
            .119111bcb55554554e......
            .111119c5cb44444554......
            ..1111.554cb4444455......
            .......5448cb8884555.....
            ......554488cb884455.....
            .......448888cb84445.....
            ......22288888cb4444.....
            ......222888f88cb222.....
            .......22888f888cb22.....
            .........888f8888222.....
            .........88fff888.cb.....
            .........88ffff88..c.....
            .........8fff.fff........
            ..........ec...ec........
            .........ecc..ecc........
            `,img`
            .........................
            .........................
            .........................
            .........................
            .........................
            ..........222222.........
            ..........4444222........
            ..........dddd422........
            .........dfddfd42........
            .........ddddddd4........
            .....1111.2222222........
            .....1191112222442.......
            ....111111114445422......
            ....1191191155554e22.....
            ...111111111554554e2.....
            ....11119111554554e......
            ....b..111c44444554......
            ....cb.bcc444444455......
            .....cbbcb8888884555.....
            ......cc4cb888884455.....
            ......5448cb88884445.....
            ......22288cb8884444.....
            ......222888cb888222.....
            .......22888fcb88222.....
            .........888f8cb8222.....
            .........88fff8cb........
            .........88ffff8cb.......
            .........8fff.fffcb......
            ..........ec...ec.cb.....
            .........ecc..ecc..c.....
            `,img`
            .........................
            .........................
            .........................
            .........................
            .........................
            ..........222222.........
            ..........4111222........
            ........111111122........
            ........111111912........
            ........191111114........
            ........111119112........
            ........1191111442.......
            .........1111145422......
            ........555555554e22.....
            ........5455554554e2.....
            ........5455554554e......
            ........54444444554......
            .......554444444455......
            .......5448888884555.....
            ..bbb.55448888884455.....
            ..cccb54488888884445.....
            .bb..cb2288888884444.....
            .ccb..cb2888f8888222.....
            b..cbbcbbbb8f8888222.....
            cb..cccccccbbbbbbbb2.....
            .cbbbc...88ccccccccbbbb..
            ..ccc....88ffff88..cccc..
            .........8fff.fff........
            ..........ec...ec........
            .........ecc..ecc........
            `,img`
            .........................
            .........................
            .........................
            .........................
            .........................
            .........1111111.........
            .........11111111........
            ........11911111111......
            .......111111191111......
            .......11144111111.......
            .......4444111111........
            ........1111111142.......
            .........4444445422......
            ........555555554e22.....
            ........5455554554e2.....
            ........5455554554e......
            ........54444444554......
            .......554444444455......
            .......5448888884555.....
            ......55448888884455.....
            ......54488888884445.....
            ......22288888884444.....
            ..bbb.222888f8888222.....
            ..cccb.22888f8888222.....
            .bb..cb..888f8888222.....
            .ccb..cb.88fff888........
            b..cbbcbbbbffff88........
            cb..cccccccbbbbbbbb......
            .cbbbc....eccccccccbbbb..
            ..ccc....ecc..ecc..cccc..
            `,img`
            .........................
            .........................
            .........................
            .........................
            .........................
            .........1111111.........
            .........11111111........
            ........11911111111......
            .......111111191111......
            .......11144111111.......
            .......4444111111........
            ........1111111142.......
            .........4444445422......
            ........555555554e22.....
            ........5455554554e2.....
            ........5455554554e......
            ........54444444554......
            .......554444444455......
            .......5448888884555.....
            ......55448888884455.....
            ......54488888884445.....
            ......22288888884444.....
            ..bbb.222888f8888222.....
            ..cccb.22888f8888222.....
            .bb..cb..888f8888222.....
            .ccb..cb.88fff888........
            b..cbbcbbbbffff88........
            cb..cccccccbbbbbbbb......
            .cbbbc....eccccccccbbbb..
            ..ccc....ecc..ecc..cccc..
            `,img`
            .........................
            .........................
            .........................
            .........................
            .........................
            .........1111111.........
            .........11111111........
            ........11911191111......
            .......111111111111......
            .......11114411111.......
            .......1111111111........
            ........1111111142.......
            .........4444445422......
            ........555555554e22.....
            ........5455554554e2.....
            ........5455554554e......
            ........54444444554......
            .......554444444455......
            .......5448888884555.....
            ......55448888884455.....
            ......54488888884445.....
            ......22288888884444.....
            ..bbb.222888f8888222.....
            ..cccb.22888f8888222.....
            .bb..cb..888f8888222.....
            .ccb..cb.88fff888........
            b..cbbcbbbbffff88........
            cb..cccccccbbbbbbbb......
            .cbbbc....eccccccccbbbb..
            ..ccc....ecc..ecc..cccc..
            `,img`
            .........................
            .........................
            .........................
            .........................
            .........................
            .........1111111.........
            .........11111111........
            ........11111119111......
            .......111111111441......
            .......11119144411.......
            .......1111111111........
            ........1111111142.......
            .........4444445422......
            ........555555554e22.....
            ........5455554554e2.....
            ........5455554554e......
            ........54444444554......
            .......554444444455......
            .......5448888884555.....
            ......55448888884455.....
            ......54488888884445.....
            ......22288888884444.....
            ..bbb.222888f8888222.....
            ..cccb.22888f8888222.....
            .bb..cb..888f8888222.....
            .ccb..cb.88fff888........
            b..cbbcbbbbffff88........
            cb..cccccccbbbbbbbb......
            .cbbbc....eccccccccbbbb..
            ..ccc....ecc..ecc..cccc..
            `,img`
            .........................
            .........................
            .........................
            .........................
            .........................
            .........1111111.........
            .........11111111........
            ........11111119111......
            .......111111111441......
            .......11119144411.......
            .......1111111111........
            ........1111111142.......
            .........4444445422......
            ........555555554e22.....
            ........5455554554e2.....
            ........5455554554e......
            ........54444444554......
            .......554444444455......
            .......5448888884555.....
            ......55448888884455.....
            ......54488888884445.....
            ......22288888884444.....
            ..bbb.222888f8888222.....
            ..cccb.22888f8888222.....
            .bb..cb..888f8888222.....
            .ccb..cb.88fff888........
            b..cbbcbbbbffff88........
            cb..cccccccbbbbbbbb......
            .cbbbc....eccccccccbbbb..
            ..ccc....ecc..ecc..cccc..
            `,img`
            .........................
            .........................
            .........................
            .........................
            .........................
            .........1111111.........
            .........11111111........
            ........11911191111......
            .......111111111111......
            .......11114411111.......
            .......1111111111........
            ........1111111142.......
            .........4444445422......
            ........555555554e22.....
            ........5455554554e2.....
            ........5455554554e......
            ........54444444554......
            .......554444444455......
            .......5448888884555.....
            ......55448888884455.....
            ......54488888884445.....
            ......22288888884444.....
            ..bbb.222888f8888222.....
            ..cccb.22888f8888222.....
            .bb..cb..888f8888222.....
            .ccb..cb.88fff888........
            b..cbbcbbbbffff88........
            cb..cccccccbbbbbbbb......
            .cbbbc....eccccccccbbbb..
            ..ccc....ecc..ecc..cccc..
            `,img`
            .........................
            .........................
            .........................
            .........................
            .........................
            .........................
            .........................
            .........................
            .........1111111.........
            .........11111111........
            ........119111911.1......
            .......1111111111.1......
            .......1111441111........
            .......1111111111........
            ........1111111142.......
            .........4444445422......
            ........555555554e22.....
            ........5455554554e2.....
            ........5455554554e......
            ........54444444554......
            .......554444444455......
            .......5448888884555.....
            ..bbb.55448888884455.....
            ..cccb54488888884445.....
            .bb..c22288888884444.....
            .ccb..cb.88fff888........
            b..cbbcbbbbffff88........
            cb..cccccccbbbbbbbb......
            .cbbbc....eccccccccbbbb..
            ..ccc....ecc..ecc..cccc..
            `,img`
            .........................
            .........................
            .........................
            .........................
            .........................
            .........................
            .........................
            .........................
            .........................
            .........................
            .........................
            .........1111111.........
            .........11111111........
            ........119111911........
            ........1111111111.......
            ........1114411111.......
            ........111111111........
            ........1111111142.......
            .........4444445422......
            ........555555554e22.....
            ........5455554554e2.....
            ........5455554554e......
            ..bbb.22544444445542.....
            ..cccb.5544444444552.....
            .bb..cb5448888884555.....
            .ccb..cb448888884455.....
            b..cbbcbbbb888884445.....
            cb..cccccccbbbbbbbb4.....
            .cbbbc....eccccccccbbbb..
            ..ccc....ecc..ecc..cccc..
            `,img`
            .........................
            .........................
            .........................
            .........................
            .........................
            .........................
            .........................
            .........................
            ..........221111.........
            .........11111112........
            ........119111911........
            .........11111111........
            ........1114411111.......
            ........111111111........
            .........222221142.......
            .........4444445422......
            ........555555554e22.....
            ........5455554554e2.....
            ........5455554554e......
            ..bbb...54444444554......
            ..cccb.554444444455......
            .bb..cb5448888884555.....
            .ccb..cb448888884455.....
            b..cbbcbbbb888884445.....
            cb..cccccccbbbbbbbb4.....
            .cbbbc...88ccccccccbbbb..
            ..ccc....88ffff88..cccc..
            .........88ffff88........
            ..........ec..eec........
            .........ecc..ecc........
            `,img`
            .........................
            .........................
            .........................
            .........................
            .........................
            ..........222222.........
            .........11114222........
            ........119111922........
            .........11111142........
            .......b.11441dd4........
            .....b.cb.1111111........
            .....cb.cb22221142.......
            ......cb.cb44445422......
            ....b..cbbc555554e22.....
            ....cb.bcc55554554e2.....
            .....cbbcb55554554e......
            ......cc5cb44444554......
            .......554cb4444455......
            .......5448cb8884555.....
            ......554488cb884455.....
            ......5448888cb84445.....
            ......22288888cb4444.....
            ......222888f88cb222.....
            .......22888f888cb22.....
            .........888f8888cb2.....
            .........88fff888.cb.....
            .........88ffff88..c.....
            .........8fff.fff........
            ..........ec...ec........
            .........ecc..ecc........
            `,img`
            .........................
            .........................
            .........................
            .........................
            .........................
            ..........222222.........
            ..........4444222........
            ..........d11d422........
            .........d9119142........
            .......b.d4441dd4........
            .....b.cb.2222222........
            .....cb.cb22222442.......
            ......cb.cb44445422......
            ....b..cbbc555554e22.....
            ....cb.bcc55554554e2.....
            .....cbbcb55554554e......
            ......cc5cb44444554......
            .......554cb4444455......
            .......5448cb8884555.....
            ......554488cb884455.....
            ......5448888cb84445.....
            ......22288888cb4444.....
            ......222888f88cb222.....
            .......22888f888cb22.....
            .........888f8888cb2.....
            .........88fff888.cb.....
            .........88ffff88..c.....
            .........8fff.fff........
            ..........ec...ec........
            .........ecc..ecc........
            `,img`
            .........................
            .........................
            .........................
            .........................
            .........................
            ..........222222.........
            ..........4444222........
            ..........dddd422........
            .........dfddfd42........
            .........ddddddd4........
            ..........2222222........
            .........222222442.......
            .........4444445422......
            ........555555554e22.....
            ........5455554554e2.....
            ........5455554554e......
            ........54444444554......
            .......554444444455......
            .......5448888884555.....
            ......55448888884455.....
            ......54488888884445.....
            ......22288888884444.....
            ......222888f8888222.....
            .......22888f8888222.....
            .........888f8888222.....
            .........88fff888........
            .........88ffff88........
            .........8fff.fff........
            ..........ec...ec........
            .........ecc..ecc........
            `]
        if (sprites.readDataBoolean(value, "lookingRight")) {
            for (let value of frames) {
                value.flipX()
            }
        }
        animation.runImageAnimation(
        value,
        frames,
        150,
        false
        )
    }
})
function isSpotted (enemy: Sprite, player2: Sprite) {
    if (sneaking) {
        return false
    }
    dist = enemy.x - player2.x
    if (sprites.readDataBoolean(enemy, "lookingRight")) {
        return -80 < dist && dist < 0
    } else {
        return 0 < dist && dist < 80
    }
    return false
}
controller.left.onEvent(ControllerButtonEvent.Pressed, function () {
    if (lookingRight) {
        switchDirections()
    }
})
function switchDirections () {
    lookingRight = !(lookingRight)
    bunny.image.flipX()
}
controller.right.onEvent(ControllerButtonEvent.Pressed, function () {
    if (!(lookingRight)) {
        switchDirections()
    }
})
function checkNewArea () {
    numOfNewRighChunks = toChunkIdx(scene.cameraProperty(CameraProperty.Right)) - farthestRight
    if (0 < numOfNewRighChunks) {
        for (let index = 0; index <= numOfNewRighChunks - 1; index++) {
            spawnChunk((index + 2 + farthestRight) * chunkWidth)
        }
        farthestRight = toChunkIdx(scene.cameraProperty(CameraProperty.Right))
    }
    numOfNewLeftChunks = farthestLeft - toChunkIdx(scene.cameraProperty(CameraProperty.Left))
    if (0 < numOfNewLeftChunks) {
        for (let index = 0; index <= numOfNewLeftChunks - 1; index++) {
            spawnChunk((farthestLeft - (index + 2)) * chunkWidth)
        }
        farthestLeft = toChunkIdx(scene.cameraProperty(CameraProperty.Left))
    }
}
function spawnFarmer (homeX: number) {
    farmer = sprites.create(img`
        .........................
        .........................
        .........................
        .........................
        .........................
        ..........222222.........
        ..........4444222........
        ..........dddd422........
        .........dfddfd42........
        .......b.ddddddd4........
        .....b.cb.2222222........
        .....cb.cb22222442.......
        ......cb.cb44445422......
        ....b..cbbc555554e22.....
        ....cb.bcc55554554e2.....
        .....cbbcb55554554e......
        ......cc5cb44444554......
        .......554cb4444455......
        .......5448cb8884555.....
        ......554488cb884455.....
        .......448888cb84445.....
        ......22288888cb4444.....
        ......222888f88cb222.....
        .......22888f888cb22.....
        .........888f8888222.....
        .........88fff888.cb.....
        .........88ffff88..c.....
        .........8fff.fff........
        ..........ec...ec........
        .........ecc..ecc........
        `, SpriteKind.Enemy)
    farmer.bottom = 88
    farmer.x = homeX + chunkWidth / 2
    sprites.setDataBoolean(farmer, "lookingRight", false)
    sprites.setDataString(farmer, "state", "stopped")
    sprites.setDataNumber(farmer, "nextEvent", game.runtime() + 2500)
    sprites.setDataNumber(farmer, "boundLeft", homeX - chunkWidth * 3)
    sprites.setDataNumber(farmer, "boundRight", homeX + chunkWidth * 4)
    fence = sprites.create(img`
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . e e e e . . . . . . 
        . . . . . . e e e e . . . . . . 
        . . . . . . e e e e . . . . . . 
        . . . . . . . e e . . . . . . . 
        . . . . . . . e e . . . . . . . 
        `, SpriteKind.Scene)
    fence.bottom = 88
    fence.x = sprites.readDataNumber(farmer, "boundLeft")
    fence = sprites.create(img`
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . . . . . . . . . . . 
        . . . . . . e e e e . . . . . . 
        . . . . . . e e e e . . . . . . 
        . . . . . . e e e e . . . . . . 
        . . . . . . . e e . . . . . . . 
        . . . . . . . e e . . . . . . . 
        `, SpriteKind.Scene)
    fence.bottom = 88
    fence.x = sprites.readDataNumber(farmer, "boundRight")
}
function startEnemyState (enemy: Sprite, state: string) {
    sprites.setDataString(enemy, "state", state)
    sprites.setDataNumber(enemy, "nextEvent", game.runtime() + randint(1000, 3000))
    if (state == "stopped") {
        enemy.vx = 0
    } else if (state == "wandering") {
        if (sprites.readDataBoolean(enemy, "lookingRight")) {
            enemy.vx = 20
        } else {
            enemy.vx = -20
        }
    } else if (state == "turning") {
        enemy.vx = 0
        sprites.setDataBoolean(enemy, "lookingRight", !(sprites.readDataBoolean(enemy, "lookingRight")))
        enemy.image.flipX()
    }
    if (state == "chasing") {
        sprites.setDataNumber(enemy, "nextEvent", game.runtime() + 3000)
        frames = [img`
            .........................
            .........................
            .........................
            .........................
            .........................
            .........................
            .........222222...2......
            .........4444222.22......
            ........ffddff22.2e22....
            ........d2dd2d42.222e....
            ........ddddddd422eee....
            .........22222244ee......
            ........5222244545.......
            ......55555555555555.....
            ......55455555554555.....
            ..cccc55445555544454.....
            ......c4.45555444454.....
            ......c2..4444444.22.....
            .cccccccccccccccccc2cccc.
            ......c...888888f........
            ......c..888f888f........
            ..cccc...88ff888f........
            .........88f888f.........
            .........88f8888f........
            .........88f8888f........
            .........88ff8888........
            .........88ffff8cc.......
            .........8fff...ecc......
            ..........ec....ec.......
            .........ecc.............
            `,img`
            .........................
            .........................
            .........................
            .........................
            .........................
            .........................
            .........................
            .........222222..........
            .........4444222..22.2...
            ........ffddff22.22222...
            ........d2dd2d422e2ee2...
            ........ddddddd4222......
            .......55222222455522....
            ......55522224455555e....
            ..cccc55445555554454.....
            ......c4455555554454.....
            ......c2.55555444.22.....
            .cccccccccccccccccc2cccc.
            ......c...888888f........
            ......c...888888f........
            ..cccc...88ff888f........
            .........88f888f.........
            .........8f888f..........
            ..........f88ff..........
            ..........888f8..........
            ..........88f888.........
            ........ee88f888.........
            ........eeeff.ee.........
            .........cc..ee..........
            .........................
            `,img`
            .........................
            .........................
            .........................
            .........................
            .........................
            .........................
            .........222222..........
            .........4444222..2......
            ........ffddff22.22......
            ........d2dd2d42.2e22....
            ........ddddddd42ee2e....
            .........2222224422ee....
            ........5222244545e......
            .......5555555555555.....
            ......55455555554555.....
            ..cccc55445555544454.....
            ......c4.45555444454.....
            ......c2..4444444.22.....
            .cccccccccccccccccc2cccc.
            ......c...ff8888f........
            ......c.8888f888.........
            ..cccc..888f888f.........
            ........f88f888f.........
            .........f8f888f.........
            .........ff8f88f.........
            ...........ff8f..........
            ...........ecec..........
            .............ec..........
            ............ecc..........
            .........................
            `,img`
            .........................
            .........................
            .........................
            .........................
            .........................
            .........................
            .........................
            .........222222..........
            .........4444222.........
            ........ffddff22.222.....
            ........d2dd2d4222e.e2...
            ........ddddddd4ee22.....
            .......55222222455522....
            ......55522224455555e2...
            ..cccc55445555554454e....
            ......c4455555554454.....
            ......c2.55555444.22.....
            .cccccccccccccccccc2cccc.
            ......c...8888888........
            ......c..88888888f.......
            ..cccc...888f8888f.......
            ........8888f8888ff......
            ........8888ff8888f......
            ........8888ff8888f......
            ........8888f.f888f......
            ........e88f...f88f......
            ......eeccff....f8fc.....
            .......cc.........ec.....
            .................ecc.....
            .........................
            `]
        if (sprites.readDataBoolean(enemy, "lookingRight")) {
            for (let value of frames) {
                value.flipX()
            }
            enemy.vx = 80
        } else {
            enemy.vx = -80
        }
        animation.runImageAnimation(
        enemy,
        frames,
        200,
        true
        )
    } else {
        animation.stopAnimation(animation.AnimationTypes.All, enemy)
        enemy.setImage(img`
            .........................
            .........................
            .........................
            .........................
            .........................
            ..........222222.........
            ..........4444222........
            ..........dddd422........
            .........dfddfd42........
            .......b.ddddddd4........
            .....b.cb.2222222........
            .....cb.cb22222442.......
            ......cb.cb44445422......
            ....b..cbbc555554e22.....
            ....cb.bcc55554554e2.....
            .....cbbcb55554554e......
            ......cc5cb44444554......
            .......554cb4444455......
            .......5448cb8884555.....
            ......554488cb884455.....
            .......448888cb84445.....
            ......22288888cb4444.....
            ......222888f88cb222.....
            .......22888f888cb22.....
            .........888f8888222.....
            .........88fff888.cb.....
            .........88ffff88..c.....
            .........8fff.fff........
            ..........ec...ec........
            .........ecc..ecc........
            `)
        if (sprites.readDataBoolean(enemy, "lookingRight")) {
            enemy.image.flipX()
        }
    }
}
function switchModes (sneaking: boolean) {
    if (sneaking) {
        controller.moveSprite(bunny, 0, 0)
        animation.runImageAnimation(
        bunny,
        [img`
            . . . . . . . . . . . . . . . . 
            . . . . 1 1 1 1 . . . . . . . . 
            . . . 1 3 3 1 3 1 . . . . . . . 
            . . . . . . 1 1 1 . . . . . . . 
            . . . . . . 1 1 f 1 . . . . . . 
            . . . . . . 1 1 1 1 . . . . . . 
            . . . . . . . 1 . . . . . . . . 
            . . . . . . 1 1 1 . . . . . . . 
            . . . . . . 1 1 1 . . . . . . . 
            . . . . . 1 1 1 1 1 . . . . . . 
            . . . . 1 . 1 1 1 . 1 . . . . . 
            . . . . . . 1 1 1 . . . . . . . 
            . . . . . . . 1 1 1 . . . . . . 
            . . . . . . 1 1 1 1 . . . . . . 
            . . . . . . 1 . . 1 . . . . . . 
            . . . . . . . . . . . . . . . . 
            `,img`
            . . . . . . . 1 . . . . . . . . 
            . . . . . 1 1 3 1 . . . . . . . 
            . . . . 1 3 1 1 1 . . . . . . . 
            . . . . 1 3 1 1 f 1 . . . . . . 
            . . . . 1 3 1 1 1 1 . . . . . . 
            . . . . . . . 1 . . . . . . . . 
            . . . . . . 1 1 1 . . . . . . . 
            . . . . . . 1 1 1 . . . . . . . 
            . . . . . 1 1 1 1 1 . . . . . . 
            . . . . 1 . 1 1 1 . 1 . . . . . 
            . . . . . . 1 1 1 1 . . . . . . 
            . . . . . . 1 1 1 1 . . . . . . 
            . . . . . . 1 1 1 . . . . . . . 
            . . . . . . 1 . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            `,img`
            . . . . 1 1 1 1 . . . . . . . . 
            . . . . 3 3 1 3 1 . . . . . . . 
            . . . . . 3 1 3 1 . . . . . . . 
            . . . . . . 1 1 1 . . . . . . . 
            . . . . 1 . 1 1 f 1 . . . . . . 
            . . . . 1 . 1 1 1 1 . . . . . . 
            . . . . . 1 . 1 . 1 . . . . . . 
            . . . . . . 1 1 1 . . . . . . . 
            . . . . . . 1 1 1 . . . . . . . 
            . . . . . . 1 1 1 . . . . . . . 
            . . . . . . 1 1 1 . . . . . . . 
            . . . . . . 1 1 1 . . . . . . . 
            . . . . . . 1 1 1 . . . . . . . 
            . . . . . . 1 . 1 . . . . . . . 
            . . . . . . 1 . 1 . . . . . . . 
            . . . . . . . . . . . . . . . . 
            `,img`
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . 1 1 1 1 . . . . . . . . 
            . . . . 3 3 1 3 1 . . . . . . . 
            . . . . . 3 1 3 1 . . . . . . . 
            . . . . . . 1 1 1 . . . . . . . 
            . . . . 1 . 1 1 f 1 . . . . . . 
            . . . . 1 . 1 1 1 1 . . . . . . 
            . . . . . 1 . 1 . 1 . . . . . . 
            . . . . . . 1 1 1 . . . . . . . 
            . . . . . . 1 1 1 . . . . . . . 
            . . . . . . 1 1 1 . . . . . . . 
            . . . . . . 1 1 1 . . . . . . . 
            . . . . . . 1 1 1 . . . . . . . 
            `,img`
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . 1 . . . . . . . . . . 
            . . . . . 3 1 1 1 . . . . . . . 
            . . . . . 3 1 3 1 . . . . . . . 
            . . . . . 3 1 3 1 . . . . . . . 
            . . . . . 3 1 3 1 . . . . . . . 
            . . . . . 3 1 3 1 . . . . . . . 
            . . . . . . 1 1 1 . . . . . . . 
            . . . . 1 . 1 1 f 1 . . . . . . 
            . . . . 1 . 1 1 1 1 . . . . . . 
            . . . . . 1 . 1 . 1 . . . . . . 
            `],
        100,
        false
        )
        pause(500)
        bunny.setImage(img`
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . 1 1 . 1 1 . . . . . . 
            . . . . . 1 3 1 3 1 . . . . . . 
            . . . . . . 3 1 3 1 . . . . . . 
            . . . . . . . 1 . 1 . . . . . . 
            . . . . . . . 1 1 1 . . . . . . 
            . . . . . . . 1 1 f 1 . . . . . 
            `)
        bunny.bottom = 90
        controller.moveSprite(bunny, 100, 0)
    } else {
        controller.moveSprite(bunny, 0, 0)
        bunny.bottom = 88
        animation.runImageAnimation(
        bunny,
        [img`
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . 1 1 . 1 1 . . . . . . 
            . . . . . 1 3 1 3 1 . . . . . . 
            . . . . . . 3 1 3 1 . . . . . . 
            . . . . . . . 1 . 1 . . . . . . 
            . . . . . . . 1 1 1 . . . . . . 
            . . . . . . . 1 1 f 1 . . . . . 
            `,img`
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . 1 1 1 1 1 . . . . . . 
            . . . . 1 3 3 1 1 f 1 . . . . . 
            . . . . . . . 1 1 1 1 . . . . . 
            . . . . . . . . 1 . . . . . . . 
            . . . . . . . 1 1 1 . . . . . . 
            . . . . . 1 1 1 1 1 1 1 . . . . 
            . . . . . . . 1 1 1 . . . . . . 
            . . . . . . . 1 1 1 . . . . . . 
            . . . . . . . 1 1 1 . . . . . . 
            . . . . . . . 1 1 1 . . . . . . 
            . . . . . . . 1 . 1 . . . . . . 
            `,img`
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . 1 1 1 1 1 . . . . 
            . . . . . . 1 f 1 1 3 3 1 . . . 
            . . . . . . 1 1 1 1 . . . . . . 
            . . . . . . . . 1 . . . . . . . 
            . . . . . . . 1 1 1 . . . . . . 
            . . . . . 1 1 1 1 1 1 1 . . . . 
            . . . . . . . 1 1 1 . . . . . . 
            . . . . . . . 1 1 1 . . . . . . 
            . . . . . . . 1 1 1 . . . . . . 
            . . . . . . . 1 1 1 . . . . . . 
            . . . . . . . 1 . 1 . . . . . . 
            `,img`
            . . . . . . . . . . . . . . . . 
            . . . . . 1 1 . 1 1 . . . . . . 
            . . . . . 1 3 1 3 1 . . . . . . 
            . . . . . . 3 1 3 1 . . . . . . 
            . . . . . . . 1 . 1 . . . . . . 
            . . . . . . . 1 1 1 . . . . . . 
            . . . . . . . 1 1 f 1 . . . . . 
            . . . . . . . 1 1 1 1 . . . . . 
            . . . . . . . . 1 . . . . . . . 
            . . . . . . . 1 1 1 . . . . . . 
            . . . . . 1 1 1 1 1 1 1 . . . . 
            . . . . . . . 1 1 1 . . . . . . 
            . . . . . . . 1 1 1 . . . . . . 
            . . . . . . . 1 1 1 . . . . . . 
            . . . . . . . 1 1 1 . . . . . . 
            . . . . . . . 1 . 1 . . . . . . 
            `,img`
            . . . . . . . . . . . . . . . . 
            . . . . . . . 1 1 . 1 1 . . . . 
            . . . . . . . 1 3 1 3 1 . . . . 
            . . . . . . . 1 3 1 3 . . . . . 
            . . . . . . . 1 . 1 . . . . . . 
            . . . . . . . 1 1 1 . . . . . . 
            . . . . . . 1 f 1 1 . . . . . . 
            . . . . . . 1 1 1 1 . . . . . . 
            . . . . . . . . 1 . . . . . . . 
            . . . . . . . 1 1 1 . . . . . . 
            . . . . . 1 1 1 1 1 1 1 . . . . 
            . . . . . . . 1 1 1 . . . . . . 
            . . . . . . . 1 1 1 . . . . . . 
            . . . . . . . 1 1 1 . . . . . . 
            . . . . . . . 1 1 1 . . . . . . 
            . . . . . . . 1 . 1 . . . . . . 
            `,img`
            . . . . 1 1 . 1 1 . . . . . . . 
            . . . . 1 3 1 3 1 . . . . . . . 
            . . . . . 3 1 3 1 . . . . . . . 
            . . . . . . 1 . 1 . . . . . . . 
            . . . . . . 1 1 1 . . . . . . . 
            . . . . . . 1 1 f 1 . . . . . . 
            . . . . . . 1 1 1 1 . . . . . . 
            . . . . . . . 1 . . . . . . . . 
            . . . . . . 1 1 1 . . . . . . . 
            . . . . 1 1 1 1 1 1 1 . . . . . 
            . . . . . . 1 1 1 . . . . . . . 
            . . . . . . 1 1 1 . . . . . . . 
            . . . . . . 1 1 1 . . . . . . . 
            . . . . . . 1 1 1 . . . . . . . 
            . . . . . . 1 . 1 . . . . . . . 
            . . . . . 1 1 . 1 1 . . . . . . 
            `],
        200,
        false
        )
        pause(1000)
        controller.moveSprite(bunny, 100, 0)
    }
    lookingRight = true
}
function updateCamera () {
    cameraWindowFront = bunny.x + 30
    cameraWindowBack = bunny.x - 30
    if (scene.cameraProperty(CameraProperty.Right) < cameraWindowFront) {
        scene.centerCameraAt(scene.cameraProperty(CameraProperty.X) + (cameraWindowFront - scene.cameraProperty(CameraProperty.Right)), scene.cameraProperty(CameraProperty.Y))
    }
    if (cameraWindowBack < scene.cameraProperty(CameraProperty.Left)) {
        scene.centerCameraAt(scene.cameraProperty(CameraProperty.X) - (scene.cameraProperty(CameraProperty.Left) - cameraWindowBack), scene.cameraProperty(CameraProperty.Y))
    }
}
sprites.onOverlap(SpriteKind.Player, SpriteKind.Enemy, function (sprite, otherSprite) {
    if (!(sneaking) || sprites.readDataString(otherSprite, "state") == "chasing") {
        game.over(false)
    }
})
let cameraWindowBack = 0
let cameraWindowFront = 0
let fence: Sprite = null
let farmer: Sprite = null
let numOfNewLeftChunks = 0
let numOfNewRighChunks = 0
let dist = 0
let frames: Image[] = []
let isIdle = false
let dune: Sprite = null
let carrot: Sprite = null
let spawnChoice = 0
let chunkWidth = 0
let lookingRight = false
let farthestRight = 0
let farthestLeft = 0
let sneaking = false
let bunny: Sprite = null
scene.setBackgroundImage(img`
    8888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888188888888888888888888888888888888888888888888888888
    8888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888
    8888888888888888888888888888888888888888888888888888888881888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888818888888888
    8888888188888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888
    8888888888888888888888188888888888888888188888888888888888888888888888888888818888888888888888888888888888888888888888888888888888888888888888888888888888888888
    8888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888666666666668888888888
    8888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888866666666666666666666688888888
    8888888888888888888888888888888888888888666666666666666666688888888888888888888888888888888888888888888888888888888888888888888666666666666666666666666666888668
    8888888888888888888888866666666666666666666666666666666666666666666668888888888888888888888888888888888188888888888888888866666666666666666666666666666666666666
    6688888888888886666666666666666666666666666666666666666666666666666666666888888888888888888888888888888888888888888888886666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666888888888888888888888888888888888888888666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666688888888888888888666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666999999999999966699
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666699999999999999999999
    6666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666666669999999999999999999999
    6666666666666666666666669999999999999999999999666666666666666666666666666666666666666666666666666666666666666666666666666666666666666669999999999999999999999999
    6666666666666666666666699999999999999999999999999966666666666666666666666666666666666666666666666666666666666666666666666666666666999999999999999999999999999999
    6666666666666666666699999999999999999999999999999999999666666666666666666666666666666666666666666666666666666666666666669999999999999999999999999999999999999999
    6666666666666666669999999999999999999999999999999999999999999666666666666666666666666666666666666666666666666666669999999999999999999999999999999999999999999999
    6999999999999999999999999999999999999999999999999999999999999999666666666666666666666666666666666666666666999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999966666666666666666666666666666669999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999666666666666666666666666999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999666666666666666666699999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
    `)
bunny = sprites.create(img`
    . . . . 1 1 . 1 1 . . . . . . . 
    . . . . 1 3 1 3 1 . . . . . . . 
    . . . . . 3 1 3 1 . . . . . . . 
    . . . . . . 1 . 1 . . . . . . . 
    . . . . . . 1 1 1 . . . . . . . 
    . . . . . . 1 1 f 1 . . . . . . 
    . . . . . . 1 1 1 1 . . . . . . 
    . . . . . . . 1 . . . . . . . . 
    . . . . . . 1 1 1 . . . . . . . 
    . . . . 1 1 1 1 1 1 1 . . . . . 
    . . . . . . 1 1 1 . . . . . . . 
    . . . . . . 1 1 1 . . . . . . . 
    . . . . . . 1 1 1 . . . . . . . 
    . . . . . . 1 1 1 . . . . . . . 
    . . . . . . 1 . 1 . . . . . . . 
    . . . . . 1 1 . 1 1 . . . . . . 
    `, SpriteKind.Player)
sneaking = false
switchModes(sneaking)
farthestLeft = toChunkIdx(scene.cameraProperty(CameraProperty.Left))
farthestRight = toChunkIdx(scene.cameraProperty(CameraProperty.Right))
lookingRight = true
chunkWidth = 40
game.onUpdate(function () {
    updateCamera()
})
game.onUpdateInterval(500, function () {
    for (let value of sprites.allOfKind(SpriteKind.Enemy)) {
        if (sprites.readDataNumber(value, "nextEvent") < game.runtime()) {
            updateEnemy(value, sprites.readDataString(value, "state"))
        }
    }
})
game.onUpdateInterval(100, function () {
    for (let value of sprites.allOfKind(SpriteKind.Enemy)) {
        if (isSpotted(value, bunny) && !(sprites.readDataString(value, "state") == "chasing")) {
            bunny.startEffect(effects.fountain, 200)
            startEnemyState(value, "chasing")
        }
    }
})
game.onUpdateInterval(200, function () {
    checkNewArea()
})
